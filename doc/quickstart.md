# Quickstart

## Introduction

In order to use pkr, you need to create environment files. They will describe the containers you want to create, and also describe the
variables, named `metadata` or `metas` of your environment (see files and data organization).

An environment is a template, providing a default set of values for a specific kind of templating which can then be processed by pkr drivers to deploy containers.

An instance of environment is called a `kard`, which may supercede or add some `metas` from source environment (like passwords of urls).

In this example, we are going to create an environment for a simple python web application exposed through an Nginx server, built locally on docker and started with docker compose.

### Drivers

Multiple drivers exist in `pkr`, you may refer to [Drivers](drivers.md)

## Our first application pkr-ized

Let's create files for our sample application.
They can be found [here](sample/simple).

    MyApp
    ├── app
    │   └── __main__.py
    ├── etc
    │   └── nginx.conf
    └── templates
        ├── dockerfiles
        │   └── nginx.dockerfile.template
        │   └── myApp.dockerfile.template
        └── compose
            └── docker-compose.yml.template

## Choose location of your pkr project

`pkr` requires a specific file tree to work properly. It can be created anywhere but is recommended to be created in your development project.

Pkr provides an easy way to initialize its files and folder skeleton.

    pkr init $PKR_PATH

This will create a skeleton structure like the following:

    $PKR_PATH
    ├── env/
    │   └── dev/
    │       └── env.yml
    └── kard/

2 folders were created:

  * the `env` folder contains files to describe your environments. Every environment is in a dedicated folder, and is described by the  env.yml file.

  * the `kard` folder contains the generated files and driver specific files.

> **WARNING**: For pkr to know which project to reference, the `pkr` command should be run in the project subtree. You can also refer to it by exporting PKR_PATH as an environment variable.

## Create your first environment

Now you need to create your first environment.

Open the env/dev/env.yml file.

    containers:
      app:
        dockerfile: myApp.dockerfile
        requires:
          app/:
            dst: app/
      nginx:
        dockerfile: nginx.dockerfile
        requires:
          etc/nginx.conf:
            dst: nginx/nginx.conf

    driver:
      docker_compose:
        compose_file: templates/compose/docker-compose.yml.template

In this file, we referenced our docker-related files. The containers section contains the list of docker images that are going to be built by pkr. The images are referenced by a name, and they have a single attribute, which points to the dockerfile.

This path is relative to the docker-context generated by pkr. See the make step to understand how to setup this path.

The "requires" attributes specifies the files required in the docker-context, which will be copied and, optionally rendered if they are templates.

The driver section provides details to the drivers. Here, we provide the docker-compose template.

## Create your first kard

Now that we have a first environment, we can create our first kard. In pkr terminology, an environment instance is called a kard.

```
pkr kard create -e dev -d compose dev-kard
```

> **WARNING**:
   This command can require extra information, which will be requested interactively.
   This information can also be provided beforehand using the --extra argument.

```
pkr kard create -e dev -d compose dev-kard --extra tag=test
```

This command creates a kard instance, using the environment named "dev" and the docker-compose driver. The kard will be named dev-kard.

## Launch your kard

Now you can start your application!

```
pkr up
```

`pkr` will build images and start the containers.

You can now see the IP address of containers.

```
pkr ps
```

Copy the IP address of the nginx container, and try to curl its http port.

```
curl http://<the nginx ip>
```

## Encrypt your kard (optional)

Depending on your project `pkr` meta.yaml file might contain some sensitive information like passwords, api keys, etc., in plain text. This file (and docker-compose.yaml) can be encrypted with password using the following command:

```
pkr -p <password> kard encrypt
```

or to input the password interactively from the command line

```
pkr -p - kard encrypt
```

After encryption is performed, `pkr` commands expect the password to be provided with `-p` global option. For example:

```
pkr -p - start
```

If some manual modifications of the metafile are required, decryption can be performed with:

```
pkr -p - kard decrypt
```


Congratulations! Your first stack is up!
